# 身份证图片批量下载工具

这个项目提供了两个脚本，用于批量下载身份证图片：一个适用于Linux/macOS的bash脚本，一个适用于Windows的批处理脚本。支持**多CSV文件循环处理**，能够一次性处理目录中的所有CSV文件。

## 🌟 功能特点

- 🔄 **多CSV文件循环处理** - 自动扫描并处理目录中的所有CSV文件
- 🔍 **自动检测CSV文件** - 自动在当前目录中查找CSV文件
- 📁 **智能文件组织** - 为每个人创建以"工号_姓名"命名的文件夹
- 🖼️ **批量图片下载** - 同时下载多种类型的身份证图片
- 📝 **详细日志输出** - 显示下载进度和状态信息
- 🛡️ **错误处理** - 检查依赖工具和处理下载失败
- 🌏 **中文支持** - 完美支持中文文件名和路径
- 🏷️ **动态命名** - 根据CSV表头自动命名图片类型

## 📂 文件说明

### 1. download_id_cards.sh (Linux/macOS)
Bash脚本，适用于Linux和macOS系统。

### 2. download_id_cards.bat (Windows)
批处理脚本，适用于Windows系统，**支持多CSV文件循环处理**。

## 📊 CSV文件格式

脚本支持灵活的三列CSV格式，可以处理不同类型的身份证图片：

### 示例1：身份证国徽面
```csv
工号,姓名,身份证国徽面
001,张三,https://example.com/back1.jpg
002,李四,https://example.com/back2.jpg
003,王五,https://example.com/back3.jpg
```

### 示例2：身份证人像面
```csv
工号,姓名,身份证人像面
001,张三,https://example.com/front1.jpg
002,李四,https://example.com/front2.jpg
003,王五,https://example.com/front3.jpg
```

### 示例3：其他证件类型
```csv
工号,姓名,驾驶证
001,张三,https://example.com/license1.jpg
002,李四,https://example.com/license2.jpg
```

**字段说明：**
- `工号`：员工工号
- `姓名`：员工姓名
- `第三列`：图片地址（列名会作为图片类型标识）

## 🚀 使用方法

### Windows (使用 download_id_cards.bat)

#### 系统要求
- Windows 10 版本 1803 及以上（内置curl命令）
- 或者手动安装curl工具

#### 使用步骤

1. **准备CSV文件**
   - 将一个或多个CSV文件放在与批处理脚本相同的目录中
   - 确保CSV文件格式正确（三列格式）
   - 支持处理多个不同类型的CSV文件

2. **运行脚本**
   - 双击 `download_id_cards.bat` 文件
   - 或在命令提示符中运行：
     ```cmd
     download_id_cards.bat
     ```

3. **查看处理过程**
   ```
   ========================================
   身份证图片下载脚本
   ========================================
   找到3个CSV文件: idcard1.csv idcard2.csv idcard3.csv
   开始批量处理CSV文件
   输出目录: id_cards_download
   
   ========================================
   正在处理CSV文件: idcard1.csv
   ========================================
   检测到的列名: 工号, 姓名, 身份证国徽面
   处理: 张三 (工号: 001)
     下载身份证国徽面...
       ✓ 身份证国徽面下载成功: 张三_身份证国徽面.jpg
   ```

### Linux/macOS (使用 download_id_cards.sh)

#### 使用步骤

1. **准备环境**
   ```bash
   # 确保脚本有执行权限
   chmod +x download_id_cards.sh
   ```

2. **准备CSV文件**
   - 将CSV文件放在与脚本相同的目录中
   - 确保CSV文件格式正确

3. **运行脚本**
   ```bash
   ./download_id_cards.sh
   ```

## 📁 输出结构

脚本会在当前目录创建 `id_cards_download` 文件夹，支持多种图片类型的组织：

### 单CSV文件处理结果
```
id_cards_download/
├── 001_张三/
│   └── 张三_身份证国徽面.jpg
├── 002_李四/
│   └── 李四_身份证国徽面.jpg
└── 003_王五/
    └── 王五_身份证国徽面.jpg
```

### 多CSV文件处理结果
```
id_cards_download/
├── 001_张三/
│   ├── 张三_身份证人像面.jpg    ← 来自第1个CSV
│   ├── 张三_身份证国徽面.jpg    ← 来自第2个CSV
│   └── 张三_驾驶证.jpg          ← 来自第3个CSV
├── 002_李四/
│   ├── 李四_身份证人像面.jpg
│   ├── 李四_身份证国徽面.jpg
│   └── 李四_驾驶证.jpg
└── 003_王五/
    ├── 王五_身份证人像面.jpg
    ├── 王五_身份证国徽面.jpg
    └── 王五_驾驶证.jpg
```

## 🖼️ 支持的图片格式

脚本自动检测图片URL中的文件扩展名，支持以下格式：
- JPG/JPEG
- PNG
- GIF
- BMP

如果URL中没有扩展名或扩展名不在支持列表中，默认使用 `.jpg` 格式。

## 🔧 多CSV文件处理特性

### 自动检测和处理
- 脚本会自动扫描当前目录中的所有 `.csv` 文件
- 依次处理每个CSV文件，显示独立的处理进度
- 支持不同CSV文件包含不同类型的图片

### 智能合并
- 同一个人的不同类型图片会保存在同一个文件夹中
- 图片文件名格式：`姓名_图片类型.扩展名`
- 避免文件覆盖，支持多种证件类型共存

### 处理示例
如果目录中有以下CSV文件：
- `身份证正面.csv` - 包含身份证人像面
- `身份证反面.csv` - 包含身份证国徽面
- `驾驶证.csv` - 包含驾驶证图片

脚本会自动处理所有文件，为每个人下载所有类型的证件图片。

## ⚠️ 错误处理

### 常见错误及解决方法

1. **找不到CSV文件**
   ```
   错误: 当前目录下没有找到CSV文件
   ```
   - 确保当前目录中有CSV文件
   - 检查文件扩展名是否为 `.csv`

2. **curl命令不可用（Windows）**
   ```
   错误: 系统中未找到curl命令
   ```
   - 升级到Windows 10版本1803及以上
   - 或手动安装curl工具

3. **图片下载失败**
   ```
   ✗ 身份证国徽面下载失败: https://example.com/image.jpg
   ```
   - 检查网络连接
   - 验证图片URL是否有效
   - 确认图片服务器是否可访问

4. **中文乱码问题**
   - Linux/macOS：确保终端支持UTF-8编码
   - Windows：脚本已自动设置UTF-8编码

## ⚡ 使用技巧

### 批量处理建议
1. **文件命名规范**：使用有意义的CSV文件名，如 `身份证正面.csv`、`身份证反面.csv`
2. **网络稳定性**：确保稳定的网络连接，避免下载中断
3. **存储空间**：预先检查磁盘空间，确保有足够空间存储图片
4. **URL有效性**：处理前验证CSV中的图片URL是否有效

### 性能优化
- 脚本会跳过空URL，不会影响处理速度
- 下载失败的图片不会阻止其他图片的下载
- 支持断点续传（如果图片已存在，不会重复下载）

## 📋 注意事项

⚠️ **重要提醒：**

1. **网络要求**：需要稳定的网络连接来下载图片
2. **存储空间**：确保有足够的磁盘空间存储下载的图片
3. **URL有效性**：确保CSV文件中的图片URL是有效的
4. **权限问题**：确保脚本有写入当前目录的权限
5. **隐私安全**：请确保处理的身份证图片符合相关法律法规
6. **文件覆盖**：同名文件会被覆盖，请注意备份

## 🔬 技术细节

### Windows批处理脚本特点
- 使用Windows内置的 `curl` 命令下载图片
- 启用延迟变量扩展处理循环
- 设置UTF-8编码支持中文
- 详细的错误检查和状态报告
- 函数化设计，支持多文件处理

### Bash脚本特点
- 使用 `curl` 命令下载图片
- 使用 `sed` 处理CSV字段清理
- 支持多种图片格式自动检测
- 跳过空行和无效数据

### 核心算法流程
1. 扫描当前目录中的所有CSV文件
2. 对每个CSV文件：
   - 读取表头获取图片类型名称
   - 逐行处理员工信息
   - 创建个人文件夹
   - 下载并命名图片文件
3. 显示处理结果和统计信息

## 📄 许可证

本项目使用 MIT 许可证。详情请参见 [LICENSE](LICENSE) 文件。

## 🤝 贡献

欢迎提交问题报告和功能请求！如果您想贡献代码，请：

1. Fork 这个项目
2. 创建您的功能分支 (`git checkout -b feature/AmazingFeature`)
3. 提交您的更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 打开一个 Pull Request

## 📊 版本更新日志

### v2.0.0 (2025-09-08)
- ✨ 新增多CSV文件循环处理功能
- 🔄 支持一次性处理目录中所有CSV文件
- 🏷️ 动态读取表头名称作为图片类型标识
- 📁 智能文件合并，同一人的不同证件保存在同一文件夹
- 📝 优化日志输出，显示每个文件的处理进度
- 🛡️ 增强错误处理和状态报告

### v1.0.0 (2025-09-08)
- 🎉 初始版本发布
- 💻 支持Windows批处理脚本
- 🐧 支持Linux/macOS Bash脚本
- 📋 基础CSV文件处理功能
- 🖼️ 身份证图片批量下载

---

**版本**：2.0.0  
**最后更新**：2025-09-08  
**维护者**：[您的名字]